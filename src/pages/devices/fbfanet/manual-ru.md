# FlyBeeper FANET

## Инструкция

### Управление

Процедура включения: нажимаем на кнопку, ожидаем вспышку светодиода возле кнопки, спустя 2 секунды вторая вспышка - устройство включено. Это основной режим работы в течение всего сезона использования. Потребление в режиме ожидания незначительно что позволяет не выключать прибор месяцами. Если устройство уже включено, то нажатие на кнопку сброит текущее блютус соединение если оно существовало и на 2 минуты активирует частую отправку рекламных пакетов блютус, что позволяет быстрее подключиться к устройству. Через 2 минуты частота отправки таких пакетов снижается. Подключение всё еще возможно, но потребует больше времени.

Процедура выключения (транспортный режим): нажимаем на кнопку, ожидаем вспышку светодиода. Нажимаем второй раз в течение 2 секунд до второй вспышки. Если второй вспышки светодиода не последовало – устройство выключено. Данный режим используется для транспортировки и длительного хранения. В этом режиме устройство не излучает никаких радио сигналов и имеет минимальное энергопотребление.

### Расположение

Устройство следует крепить вертикально. Мощности солнечной панели хватает с запасом, поэтому особых требований к её ориентации не предъявляется. Антена располагается в верхней половине корпуса над солнечной панелью. Её диаграмма направленности такова, что максимальная мощность распространяется в направлении перпендикулярном плоскости солнечной панели. Меньше мощности распределяется в стороны и минимальное количество вверх и вниз. Для максимальной эффективности встроенной антены следует обеспечить отступ от верхней половины устройства до других устройств.

При креплении на кокпит не обязательно чтобы верхняя часть устройства выступала заграницы кокпита. Кокпит обычно выполняется из радиопрозрачной ткани и не препятствует работе устройства.

### Зарядка

Устройство имеет разъем `USB Type C` и солнечную панель.

Зарядка от `USB` поддерживает большинство простых зарядных устройств кроме Power Delivery. Ток зарядки не более 500 мА.

Зарядка от солнечной панели обеспечивает ток до 20 мА. Время работы в таком режиме при обычном использовании ограничено лишь ресурсом компонентов.

### Подключение и отключение по блютус

Устройство должно быть включено, т.е. не находится в транспортном режиме. Для подключения не требуется связывания устройств через операционную систему. Устройство управлется по блютус внешним приложением. Достаточно просто запустить поддерживаемое приложение и в его интерфейсе просканировать блютус устройства вокруг для поиска устройства с именем FBFANET. Держите устройства как можно ближе друг к другу. Если вы обнаружите несколько устройств FBFANET выбирете то из них, которое будет иметь максимальный уровень сигнала. Для ускорения поиска можно однократно нажать на кнопку на устройстве - это запустит двухминутный режим с высокой частотой отправки рекламных пакетов.

Устройство автоматически отключится при выходе из приложения и перейдет в режим ожидания следующего сеанса подключения.

### Описание пртокола связи

Данный раздел предназначен больше для разработчиков чем для обычных пользователей.

Устройство работает в двух режимах - приема и отправки радио-пакетов. Режим приема активируется при подписке на уведомления соответствующей характеристики блютус. Режим отправки активируется в момент записи массива байтов в эту же характеристику. Размер массива байтов на прием или отправку ограничен 40 байтами.

UUID сервиса `0x1819`, UUID характеристики `fec81438-cb89-4c37-93d0-badfced4376e`

Параметры последнего принятого радио-пакета данных можно прочитать из следующих характеристик того же сервиса `0x1819`:

| Name | UUID                                 | Size  |
| ---- | ------------------------------------ | ----- |
| RSSI | 1d242a85-6e0a-4d10-9d6a-a3e76dfa75c6 | INT16 |
| SNR  | 6d1a7208-10b5-4244-8f45-c1d0d4ebe5c9 | INT8  |

Устройство имеет одноканальный радио-передатчик. Это значит, что в один момент времени оно может либо отправлять либо принимать только на одной выбранной частоте с текущими настройками. Однако, внешнее приложение имеет возможность изменять частоту и обеспечить попеременное прослушивание и передачу на разных частотах. Таким образом можно реализовать мульти-протокольный режим.

Характеристики UUID для сервиса `0x180F` BAS

| Name            | UUID                                 | Size  | Exponent | Unit    |
| --------------- | ------------------------------------ | ----- | -------- | ------- |
| Battery level   | 0x2a19                               | UINT8 | 0        | Percent |
| Battery voltage | b0c889e8-16d2-45ef-b615-387f6bca2370 | INT16 | -3       | Volt    |

Характеристики UUID для сервиса `0x180A` DevInfo

| Name              | UUID   | Size   | Value     |
| ----------------- | ------ | ------ | --------- |
| Model Number      | 0x2A24 | STRING | FBFANET   |
| Manufacturer Name | 0x2A29 | STRING | FlyBeeper |
| Firmware Revision | 0x2A26 | STRING | 0.01      |

### Настройка

Обычно всеми настройками управляет внешнее приложение. Однако пользователь также имеет такую возможность через графический интерфейс конфигуратора. Для работы необходимо устройство, имеющее Bluetooth модуль, например, смартфон или ноутбук или ПК с Bluetooth модулем. Перейдите на [страницу настроек](https://fbminibt-conf.flybeeper.com/settings). Нажите `Подключить` и выберете из списка `FBFANET`. Держите устройства как можно ближе друг к другу. Измените любой параметр и нажмите `Применить`.

| Name        | UUID                                 | Size   | Values                                                                |
| ----------- | ------------------------------------ | ------ | --------------------------------------------------------------------- |
| frequency   | 8d8e8809-4697-41fc-8ee2-ca0b999354ec | UINT32 | 868200000\* - EU, 920800000 - US, 866200000 - IN, 923200000 - KR (Hz) |
| bandwidth   | f19422e2-982a-4954-9a75-b38927236a59 | INT8   | 1\* — 250, 2 — 500 (kHz)                                              |
| coding_rate | 17a95752-3c12-438f-9244-4f4612a1ab49 | INT8   | 1\* — 4/5, 2 — 4/6, 3 — 4/7, 4 — 4/8                                  |
| datarate    | 108b855f-11cd-4bc5-adee-eafce49bc77a | INT8   | 7\* - SF_7, 8 - SF_8, 9 - SF_9, 10 - SF_10, 11 - SF_11, 12 - SF_12    |
| tx_power    | 8ef0c42e-adb6-4897-b9c9-6fe93143faf4 | INT8   | -9 (min), 14\*, 22 (max) (dBm)                                        |

`*` - значения по умолчанию

<router-link to="/devices/fbfanet">НАЗАД</router-link>
