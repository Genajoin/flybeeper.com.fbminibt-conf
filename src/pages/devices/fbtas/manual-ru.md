# FlyBeeper True Air Speed

## Инструкция

### Режимы работы

Устройство работает в нескольких режимах.

Первый режим - ожидание подключения по Bluetooth. Каждые 4 секунды устройство отправляет рекламный пакет, благодаря которому оно может быть обнаружено для инициализации подключения. В промежутках между рекламными пакетами устройство находится в спящем режиме. Время нахождения в данном режиме ограниченно лишь уровнем заряда батареи. Уровень энергопотребления незначительный, что дает возможность работать в этом режиме на протяжении всего летного сезона.

Как только устройство получает запрос на подключение, активируется второй режим. Подключение не требует педварительной процедуры связывания устройств через интерфейс операционно системы. Можно сразу запускать летное приложение и подключать через её интерфейс. Имя устройства FBTAS. После установления связи возможно прочитать уровень батареи и подписаться на изменение значений датчиков. В последнем случае активируется периодическое считывание данных с необходимых датчиков. В промежутках устройство находится в спящем режиме. При отключении Bluetooth соединения устройство переходит обратно в режим ожидания с периодической передачей рекламных пакетов.

Режим переподключения. В случае потери соединения устройство на несколько минут переходит в режим с повышеной частотой отправки рекламных пакетов, что обеспечит быстрое переподключение. Также этот режим активируется сразу после нажатия на кнопку сброса. Это можно использовать для ускорения процедуры первого подключения в вашем приложении.

Есть транспортный режим, в котором устройство находится в режиме сна постоянно и не транслирует никаких данных по блютус. Используется при траспортировке самолетом или при длительном хранении между сезонами. Это режим с минимальным энергопотреблением.

### Размещение

#### Для парапланов

Штатное расположение на подвесе из стропы длиной от 1м под пилотом с креплением к карабину. Хвостовое оперение обеспечивает самовыравнивание по воздушному потоку. Длина стропы должна позволить отдалить устройство от подвески пилота во избежание воздействия оптекающего сжатого потока воздуха. При недостаточном отдалении показания скорости будут выше реальных. Прибор имеет малый вес и малое фронтальное сопротивление что позволяет эффективно бороться с эффектом маятника, но при слишком большой длине стропы могут возникнуть нежелательные колебания.

При нештатном расположении, например, крепление к хвостовому оптекателю подвески - учитывайте сжатие/расширение оптекаемого воздуха. Это изменение также зависит от скорости, поэтому будет влиять на показания прибора.

#### Для дельтапланов

Необходимо использовать специальный креплежный элемент вместо хвостового оперения, который жестко фиксирует прибор на раме дельтаплана параллельно плоскости крыла. Не располагайте прибор слишком близко к крылу в зоне сжатия потока.

### Управление

Устройство не имеет никаких органов управления, кроме кнопки сброса. Устройство всегда готово к подключению кроме режима транспортировки.

Для выхода из режима транспортировки необходимо однократно нажать кнопку сброса. Кнопка имеет малую площадь и расположена в 1 мм от стенки корпуса. Будьте аккуратны. Используйте тонкую деревянную или пластиковую палочку чтобы случано не замкнуть незащищенные контактные площадки.

Для активации режима транспортировки необходимо однократно нажать кнопку сброса, затем через 1-2 секунды нажать повторно. Если вы удачно вошли в режим транспортировки вы не сможите обнаружить и подключиться к устройству по блютус.

### Зарядка

Прототип устройства имеет разъем `USB Type C` для зарядки, однако он поддерживает только простые зарядные устройства, на выходе которых всегда присутствует 5 В, например, на `USB` выходах персонального компьютера. Умные зарядные устройства и `PD` не поддерживаются.

Итоговое устройство имеет встроенную солнечную панель и не предполагает иного способа зарядки.

### Настройка

Протестировать и настроить устройство можно через графический интерфейс [конфигуратора](https://fbminibt-conf.flybeeper.com/settings). Для работы необходимо устройство, имеющее Bluetooth модуль, например, смартфон или ноутбук или ПК с Bluetooth модулем. Нажать `Connect` и выбрать из списка `FBTAS`. Держите устройства как можно ближе друг к другу. Измените любой параметр и нажмите `Apply`. Посмотреть все данные, отправляемые устройством в реальном времени можно на вкладке `Cockpit`.

`Pitot K factor (o.e.)` - калибровочный коэффициент, учитывающий конструкционную потерю давления в трубке Пито и тракте к датчику дифференциального давления. При увеличении коэффицента пропорционально увеличиваются показания IAS и TAS. Можно скорректировать по результатам измерения путевой скорости при движении в абсолютно спокойном воздухе.
`Diffirencial Pressure offset, Pa` - смещение датчика дифференциального давления относительно спокойного воздуха. По-умолчанию 0, т.к. стандартный датчик имет встроенную автокалибровку. Однако в некоторых экспериментальных экземплярах устройства может потребоваться внести смещение чтобы компенсировать дрейф датчика.

### Список летных программ с прямой поддержкой

- xcTrack v.0.9.11.10+
- SeeYou Navigator v.3.0.6+

Ожидается:

- LK8000

### Описание протокола связи

Данный раздел предназначен больше для разработчиков чем для обычных пользователей.

Устройство работает по протоколу BLE без сопряжения и авторизации. Изменения каждого параметра доступны по подписке (дескриптор 0x2902). Все нестандартные параметры имеют 128 битный UUID, дискрипторы 0x2901 с текстовым именем параметра и 0x2904 с описанием формата, экспоненты и единицы измерения. Для удобства их значения приведены в таблицах ниже.

Характеристики UUID сервиса `0x1819` LNS

| Name                  | UUID                                 | Size  | Exponent | Unit   |
| --------------------- | ------------------------------------ | ----- | -------- | ------ |
| Differential pressure | 234337bf-f931-4d2d-a13c-07e2f06a0240 | INT16 | -1       | Pascal |
| Indicated airspeed    | 234337bf-f931-4d2d-a13c-07e2f06a0248 | INT16 | -1       | km/h   |
| True airspeed         | 234337bf-f931-4d2d-a13c-07e2f06a0249 | INT16 | -1       | km/h   |

Характеристики UUID сервиса `0x181A` ESS

| Name        | UUID   | Size  | Exponent | Unit    |
| ----------- | ------ | ----- | -------- | ------- |
| Temperature | 0x2a6e | INT16 | -2       | Celcius |
| Pressure    | 0x2a6d | INT16 | -1       | Pascal  |

Характеристики UUID сервиса `0x180F` BAS

| Name            | UUID                                 | Size  | Exponent | Unit    |
| --------------- | ------------------------------------ | ----- | -------- | ------- |
| Battery level   | 0x2a19                               | UINT8 | 0        | Percent |
| Battery voltage | b0c889e8-16d2-45ef-b615-387f6bca2370 | INT16 | -3       | Volt    |

Характеристики UUID сервиса `6E400001-B5A3-F393-E0A9-E50E24DCCA9E` Nordic UART. Данный сервис добавлен для совместимости и не рекомендуется для использования в новых разработках ввиду своей большей энергозатратности.

| Name | UUID                                 | Size        |
| ---- | ------------------------------------ | ----------- |
| TX   | 6E400003-B5A3-F393-E0A9-E50E24DCCA9E | UINT8 array |

При отсутствии подписки на характеристику `0x2a6d` сервиса `0x181A` в `TX` будет записываться строка давления в формате `PRS`.

При отсутствии подписки на характеристику `234337bf-f931-4d2d-a13c-07e2f06a0248` или `234337bf-f931-4d2d-a13c-07e2f06a0249` сервиса `0x1819` в `TX` будет записываться строка со значением `TAS` в формате `$LXWP0`.

Характеристики UUID сервиса `0x180A` DevInfo

| Name              | UUID   | Size   | Value     |
| ----------------- | ------ | ------ | --------- |
| Model Number      | 0x2A24 | STRING | FBTAS     |
| Manufacturer Name | 0x2A29 | STRING | FlyBeeper |
| Firmware Revision | 0x2A26 | STRING | 0.01      |

Настройки прибора доступны для чтения и записи в сервисе `904baf04-5814-11ee-8c99-0242ac120000`. Каждая настройка имеет индивидуальный 128 битный UUID и дискрипторы 0x2901, 0x2904.

| Name                         | UUID                                 | Size  | Exponent | Unit   |
| ---------------------------- | ------------------------------------ | ----- | -------- | ------ |
| Pitot K factor               | 904baf04-5814-11ee-8c99-0242ac120201 | INT16 | -3       | o.e.   |
| Diffirencial Pressure offset | 904baf04-5814-11ee-8c99-0242ac120202 | INT16 | -1       | Pascal |

<router-link to="/devices/fbtas">НАЗАД</router-link>
